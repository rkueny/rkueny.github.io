I"¼<p>Je me suis aperÃ§u la derniÃ¨re fois que tout le monde ne connaissait pas la puissance des logs quâ€™intÃ¨gre directement PHP. Du coup, pour essayer de rectifier cela, je me suis dit quâ€™un petit article valait le coup <img src="http://rkueny.fr/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /></p>

<p>Tout dâ€™abord, et parce que vous avez le droit de ne pas connaÃ®tre, quâ€™est ce quâ€™un log ?</p>

<p>Câ€™est tout bÃªte et Ã§a simplifie la vie. Cela peut grandement vous aider Ã  vous sortir dâ€™un mauvais pas. Il sâ€™agit dâ€™enregistrer les erreurs dans un fichier. Cela vous sert dâ€™historique par exemple. Un fichier de log se prÃ©sente de cette faÃ§on (ou cela sâ€™approche en tout cas) :</p>

<pre>[01-Apr-2010] PHP Parse error:  syntax error, unexpected '}' in /Applications/www/index.php on line 6</pre>

<p>On y retrouve donc souvent la date, lâ€™erreur et le fichier avec la ligne concernÃ©e. Pratique nâ€™est ce pas ?</p>

<p>Et comment mettre cela en place avec le systÃ¨me de log propre Ã  PHP ? Pas compliquÃ© du tout.<!--more--></p>

<hr />

<p><strong>PremiÃ¨re Ã©tape : Configurer le serveur</strong></p>

<p>Normalement, vous devriez dÃ©jÃ  avoir fait cela sur votre serveur. Jâ€™y fait mention dans lâ€™article sur <a title="La gestion des erreurs php en production" href="http://rkueny.fr/developpement-web/la-gestion-des-erreurs-ph-en-production" target="_blank">la gestion des erreurs php en production</a> (relatif Ã  un article sur le blog de <a href="http://methylbro.titaxium.org/post/2009/05/29/display_errors-%C3%A0-On-sur-un-serveur-de-production-c-est-mal-!" target="_blank">MÃ©thylbro</a>)</p>

<p>Il vous faut donc activer le systÃ¨me de log et dÃ©finir un fichier de log. Cela se fait via deux lignes de votre php.ini fÃ©tiche.</p>

<blockquote>
  <p>log_errors = On</p>

  <p>error_log = /www/log/log.txt</p>
</blockquote>

<p>Vous pouvez aussi affiner votre configuration en ignorant les erreurs rÃ©pÃ©tÃ©es. Cela vous permettra dâ€™y voir plus clair dans votre fichier en regroupant 100 lignes en 1 seule par exemple. Pour cela il vous faut activer la directive : ignore_repeated_errors</p>

<blockquote>
  <p>ignore_repeated_errors = On</p>
</blockquote>

<p>Une fois cela en place, vous pouvez utiliser les logs dans votre dÃ©veloppement.</p>

<p><strong>DeuxiÃ¨me Ã©tape : utilisation du systÃ¨me</strong></p>

<p>Nous allons nous attarder sur lâ€™utilisation manuelle du systÃ¨me. Je reviendrai dans un autre article sur lâ€™utilisation dâ€™un journal systÃ¨me.</p>

<p>Le pivot de cette utilisation est la fonction <a title="error_log()" href="http://php.net/manual/en/errorfunc.configuration.php" target="_blank">error_log()</a>.</p>

<p>Nous allons ici voir plusieurs utilisations. Tout dâ€™abord une utilisation Â«Â basiqueÂ Â». Une simple Ã©criture dans le fichier dÃ©fini dans votre php.ini :</p>

<p style="text-align: center;">
  <em>error_log(&lsquo;une erreur est survenue ici&rsquo;);</em>
</p>

<p>Mais cette fonction est bien plus puissante que Ã§a !!! Vous pouvez aussi Ãªtre prÃ©venu par mail dâ€™une erreur. Il vous faudra lâ€™utiliser ainsi :</p>

<p style="text-align: center;">
  <em>error_log(&lsquo;une erreur est survenue ici&rsquo;, 1, &lsquo;votre_mail@mail.fr&rsquo;);</em>
</p>

<p>Le 1 est ici pour indiquer que vous dÃ©sirez Ãªtre prÃ©venu de cette erreur Ã  lâ€™adresse mail qui suit. ÃŠtre prÃ©venu par mail est une bonne pratique, quitte Ã  vous mettre une adresse dÃ©diÃ©e Ã  cela. Je parle ici une fois votre site en publication et non plus en production.</p>

<p>En effet, lorsque quelquâ€™un vient pirater votre site, il efface bien souvent son passage des logs. Cependant, si vous Ãªtes prÃ©venu par mail il ne pourra y toucher vu que cela sera stockÃ© sur un autre serveur. Pas mal non ?</p>

<p>Enfin, vous pouvez aussi dire Ã  la fonction dâ€™utiliser un autre fichier en utilisant le paramÃ¨tre 3.</p>

<p style="text-align: center;">
  <em>error_log(&lsquo;une erreur est survenue ici&rsquo;, 3, &lsquo;votre_fichier.txt&rsquo;);</em>
</p>

<p>Et voilÃ , vous savez ce quâ€™il y a Ã  savoir sur le systÃ¨me de log php. Si vous avez des questions ou des astuces Ã  partager nâ€™hÃ©sitez pas Ã  laisser un commentaire !</p>

<p style="text-align:center">
  <br />
</p>
:ET