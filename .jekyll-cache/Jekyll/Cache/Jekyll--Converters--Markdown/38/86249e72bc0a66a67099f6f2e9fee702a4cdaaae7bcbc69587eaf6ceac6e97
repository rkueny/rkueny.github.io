I"›6<p><strong>Comment publier sur le mur dâ€™un utilisateur Facebook ?</strong></p>

<p>Je vois souvent cette question passer et vu quâ€™il y a plusieurs faÃ§ons, je vous fait un petit billet pour y rÃ©pondre. On va y voir plusieurs choses :</p>

<blockquote>
  <ul>
    <li><strong>Les principes de base</strong></li>
    <li><strong>Lâ€™architecture de base</strong></li>
    <li><strong>La publication en php</strong></li>
    <li><strong>La publication en js</strong></li>
  </ul>
  <li style="margin-left: 35px;">
  <strong>avec confirmation</strong>
</li>
  <li style="margin-left: 35px;">
  <strong>sans confirmation</strong>
</li>
</blockquote>

<p><strong>Les principes de Â«Â baseÂ Â»</strong></p>

<p>Depuis un petit moment dÃ©jÃ  maintenant, pour pouvoir publier sur le mur dâ€™un utilisateur de votre application, vous devez lui en demander le droit. Ainsi, sachez que lâ€™accÃ¨s au mur de lâ€™utilisateur doit Ãªtre demandÃ© et acceptÃ© par la personne utilisant votre application.</p>

<p style="text-align: center;">
  <a href="http://rkueny.fr/wp-content/uploads/2011/02/facebook-pilules.jpg" rel="lightbox[1023]"><img class="size-full wp-image-1107 aligncenter" title="Application facebook" src="http://rkueny.fr/wp-content/uploads/2011/02/facebook-pilules.jpg" alt="Application facebook" width="234" height="234" /></a>
</p>

<!--more-->

<p>Ici lâ€™autorisation qui nous intÃ©resse est la suivante :</p>

<blockquote>
  <p><code class="highlighter-rouge">publish_stream</code> : <em>Enables your application to post content, comments, and likes to a userâ€™s stream and to the streams of the userâ€™s friends. With this permission, you can publish content to a userâ€™s feed at any time, without requiring offline_access. However, please note that Facebook recommends a user-initiated sharing model.</em></p>
</blockquote>

<p style="text-align: right;">
  <em>Source : <a title="Permissions facebook graph API" href="http://developers.facebook.com/docs/authentication/permissions" target="_blank">Developers Facebook</a></em><a href="http://rkueny.fr/wp-content/uploads/2011/01/facebook-autorisation-300x225.jpg" rel="lightbox[1023]"></a>
</p>

<p>Ainsi, avez cette permission vous pourrez publier/rÃ©cupÃ©rer un post, un commentaire ou les Â«Â jâ€™aimeÂ Â» du mur.</p>

<p>Entrons dÃ©sormais un peu plus dans le vif du sujet.</p>

<p><strong>Lâ€™architecture de Â«Â baseÂ Â»</strong></p>

<p>Si vous revenez un peu sur mes anciens billets vous avez Ã  peu prÃ¨s tout. Mais vu que je suis gentil, je vous mets ici le fichier de Â«Â baseÂ Â». Câ€™est la maniÃ¨re que jâ€™utilise et qui marche bien. Attention, en copiant collant cela risque bien de ne pas marcher, ici mon but est bien ciblÃ© sur les fonctions de publications de contenu (php/js). Si vous avez des questions techniques Ã  la fin de cet article, nâ€™hÃ©sitez pas Ã  laisser un commentaire.</p>

<p>Ainsi :</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="php" style="font-family:monospace;">&nbsp;
<span style="color: #339933;">&lt;</span>html xmlns<span style="color: #339933;">=</span><span style="color: #0000ff;">"http://www.w3.org/1999/xhtml"</span>
xmlns<span style="color: #339933;">:</span>og<span style="color: #339933;">=</span><span style="color: #0000ff;">"http://opengraphprotocol.org/schema/"</span>
xmlns<span style="color: #339933;">:</span>fb<span style="color: #339933;">=</span><span style="color: #0000ff;">"http://www.facebook.com/2008/fbml"</span><span style="color: #339933;">&gt;</span>
&nbsp;
<span style="color: #339933;">&lt;</span>head<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;/</span>head<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>body<span style="color: #339933;">&gt;</span>
&nbsp;
 <span style="color: #339933;">&lt;</span>div id<span style="color: #339933;">=</span><span style="color: #0000ff;">"fb-root"</span><span style="color: #339933;">&gt;&lt;/</span>div<span style="color: #339933;">&gt;</span>
 <span style="color: #339933;">&lt;</span>script type<span style="color: #339933;">=</span><span style="color: #0000ff;">"text/javascript"</span><span style="color: #339933;">&gt;</span>
&nbsp;
 window<span style="color: #339933;">.</span>fbAsyncInit <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
 FB<span style="color: #339933;">.</span>init<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>appId<span style="color: #339933;">:</span> <span style="color: #0000ff;">'xxxxxxxxx'</span><span style="color: #339933;">,</span>
 status<span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">,</span>
 cookie<span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">,</span>
 xfbml<span style="color: #339933;">:</span> <span style="color: #009900; font-weight: bold;">true</span>
 <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
 FB<span style="color: #339933;">.</span>Canvas<span style="color: #339933;">.</span>setAutoResize<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
 <span style="color: #000000; font-weight: bold;">var</span> e <span style="color: #339933;">=</span> document<span style="color: #339933;">.</span>createElement<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'script'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
 e<span style="color: #339933;">.</span>type <span style="color: #339933;">=</span> <span style="color: #0000ff;">'text/javascript'</span><span style="color: #339933;">;</span>
 e<span style="color: #339933;">.</span>src <span style="color: #339933;">=</span> document<span style="color: #339933;">.</span>location<span style="color: #339933;">.</span>protocol <span style="color: #339933;">+</span>
 <span style="color: #0000ff;">'//connect.facebook.net/fr_FR/all.js'</span><span style="color: #339933;">;</span>
 e<span style="color: #339933;">.</span>async <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
 document<span style="color: #339933;">.</span>getElementById<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'fb-root'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">.</span>appendChild<span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">&lt;/script&gt;</span>
<span style="color: #339933;">&lt;/</span>body<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;/</span>html<span style="color: #339933;">&gt;</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>Ici tout est en place pour que cela marche. Pour la rÃ©cupÃ©ration de lâ€™uid en php, la connection (php/js) rÃ©fÃ©rez-vous Ã  mes anciens billets sur le sujet.</p>

<p>La ligne 18 Â«Â FB.Canvas.setAutoResize();Â Â» permet dâ€™Ã©viter les scrollbars dans le cadre de la page Facebook.</p>

<p><strong>La publication en php</strong></p>

<p>Vous voulez publier sur le mur de votre utilisateur ? Quelque chose dans le genre :* Bidule est en train de jouer Ã  XXXX ? *Facile !!! Il vous suffit dâ€™utiliser lâ€™appel Ã  lâ€™API graph de cette faÃ§on :</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="php" style="font-family:monospace;"><span style="color: #000088;">$facebook</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">api</span><span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'/me/feed'</span><span style="color: #339933;">,</span>
<span style="color: #0000ff;">'post'</span><span style="color: #339933;">,</span>
<span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span>
<span style="color: #0000ff;">'message'</span> Â Â  Â Â Â  Â <span style="color: #339933;">=&gt;;</span> Â Â  Â <span style="color: #0000ff;">'a commencÃ© Ã  utiliser XXXXXX'</span><span style="color: #339933;">,</span>
<span style="color: #0000ff;">'picture'</span> Â Â  Â Â Â  Â <span style="color: #339933;">=&gt;</span>Â Â  Â <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span>
<span style="color: #0000ff;">'link'</span>Â Â  Â Â Â  Â Â Â  Â <span style="color: #339933;">=&gt;</span> Â Â  Â URL_APP<span style="color: #339933;">,</span>
<span style="color: #0000ff;">'name'</span>Â Â  Â Â Â  Â Â Â  Â <span style="color: #339933;">=&gt;</span> Â Â  Â <span style="color: #0000ff;">'XXXXXX'</span><span style="color: #339933;">,</span>
<span style="color: #0000ff;">'description'</span>Â Â  Â <span style="color: #339933;">=&gt;</span>Â Â  Â <span style="color: #0000ff;">'Viens jouer avec lui ...... &lt;br /&gt; test'</span><span style="color: #339933;">,</span>
<span style="color: #0000ff;">'actions'</span>Â Â  Â Â Â  Â <span style="color: #339933;">=&gt;</span>Â Â  Â <span style="color: #990000;">json_encode</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">array</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'name'</span> <span style="color: #339933;">=&amp;</span>gt<span style="color: #339933;">;</span> <span style="color: #0000ff;">'Jouez Ã  votre tour'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'link'</span> <span style="color: #339933;">=&amp;</span>gt<span style="color: #339933;">;</span> URL_APP<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
<span style="color: #0000ff;">'cb'</span>Â Â Â Â  Â Â Â  Â Â Â  Â <span style="color: #339933;">=&gt;</span> Â Â  Â <span style="color: #0000ff;">''</span>
<span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>$facebook Ã©tant lâ€™instance de votre classe Facebook.</p>

<p>DÃ©cryptons un peu tout Ã§a :<br />
On fait appel Ã  lâ€™API avec 3 arguments. Le premier indique le point dâ€™entrÃ©e, ici le mur (feed) de lâ€™utilisateur connectÃ© (me). Le deuxiÃ¨me indique la faÃ§on (post ou get) et le troisiÃ¨me ce que lâ€™ont veut poster. On va sâ€™y attarder avec cette simple image :</p>

<p style="text-align: left;">
  <img class="size-full wp-image-1104   aligncenter" title="application facebook" src="http://rkueny.fr/wp-content/uploads/2011/02/facebook-publish.jpg" alt="application facebook" width="524" height="145" />
</p>

<p style="text-align: left;">
  1 : Il sâ€™agit du message que vous avez dÃ©fini.<br /> 2 : Il sâ€™agit de lâ€™image (picture) que vous avez dÃ©fini (url). Ici, lâ€™ayant laissÃ©e vide rien nâ€™apparait <img src="http://rkueny.fr/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /><br /> 3 : Il sâ€™agit du lien avec le 4 : qui est le texte du lien (ici XXXXX)<br /> 5 : Il sâ€™agit de la description de votre publication. Nous verrons un peu plus loin comment y insÃ©rer des liens (en effet, la balise <a href=""> ne fonctionne pas.<br /> 6 : Il sâ€™agit de lâ€™action possible (actions). Avez le lien et le texte du lien.
&lt;/p&gt;

Pas compliquÃ© lorsque câ€™est Ã©crit non ? <img src="http://rkueny.fr/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" />

Cependant, attention. Avec cette fonction vous pouvez publier Ã  lâ€™insu de lâ€™utilisateur. Voici 3 raisons de ne pas le faire :

  * câ€™est interdit par Facebook <img src="http://rkueny.fr/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" />
  * les utilisateurs nâ€™aiment pas beaucoup Ã§a
  * et enfin, il est possible que cela ne fonctionne plus au bout de x envoi. Votre application est limitÃ©e par Facebook. Si vous ne gÃ©rez pas cela avec une exception câ€™est toute votre application qui plante <img src="http://rkueny.fr/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" />

<p style="text-align: left;">
  Du coup, Ã§a ne sert Ã  rien en php vous me direz ? Bien sur que si ! Cependant cela doit se dÃ©clencher aprÃ¨s une action de lâ€™utilisateur validant cela. Vous pouvez par exemple mettre dans les options de votre application, une case Ã  cocher, dÃ©cochÃ©e par dÃ©faut, disant de publier sur le mur aprÃ¨s chaque partie par exemple.
</p>

<p style="text-align: left;">
  Nous verrons ensuite comment publier en javascript et comment ajouter des liens dans la description du contenu (le nÂ°5). A bientÃ´t <img src="http://rkueny.fr/wp-includes/images/smilies/icon_wink.gif" alt=";)" class="wp-smiley" />
</p>

<p style="text-align: left;">
  PS : n&rsquo;hÃ©sitez pas Ã  poser vos questions dans les commentaies
</p>

![][1]![][2]

<p style="text-align:center">
  <br />
</p>

 [1]: file:///Users/raphaelkueny/Library/Caches/TemporaryItems/moz-screenshot.png
 [2]: file:///Users/raphaelkueny/Library/Caches/TemporaryItems/moz-screenshot-1.png
</a></p>
:ET